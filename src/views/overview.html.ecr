<html>
  <head>
    <script src='https://use.typekit.net/abb5hmw.js'></script>
    <script>
      try{Typekit.load({ async: true });}catch(e){}
    </script>

    <link rel="stylesheet" href="animate.css">
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div class="layout">
      <div class="video bordered-element" id="video_container">
        <iframe frameborder="0" scrolling="0"></iframe>
      </div>

      <div class="race-info bordered-element">
        <span class="title">The 1545</span>
        <span class="timer">
          <span class="timer-title">Elapsed Time</span>
          <span class="timer-time">38:15:54</span>
        </span>
      </div>

      <div class="schedule-ticker coming-up bordered-element" id="coming_up_container">
        <h2>Coming Up <small>Times are in UTC</small></h2>

        <template id="coming_up_element_template">
          <div class="schedule-element">
            <span class="game-name"></span>
            by
            <span class="runner-name"></span>
            <span class="team-name"></span>
            <span class="start-time"></span>
          </div>
        </template>
        <div class="schedule-elements animated">
        </div>
      </div>

      <div class="schedule-ticker featured bordered-element">
        <h2>On Screen <small>Rotates every 10 minutes</small></h2>

          <div class="schedule-element" id="on_screen_container">
            <span class="runner">ConklesToTheMax</span>
            running <span class="game">Kazooie</span>
            <span class="team-name">The Happy Little Speed Runners</span>
            <span class="estimate">Estimate: 3:45:00</span>
          </div>
      </div>


      <% runs_by_teams.each do |team, team_runs| %>
        <% current_run = team_runs[team.current_run.as(Int32)] %>
        <div class="team bordered-element" id="team<%= team.id %>">
          <header>
            <div class="meta">
              <span class="name"><%= team.name %></span>
              <span class="current-game"><%= current_run.game.name %></span>
              by
              <span class="current-runner"><%= current_run.runner.name %></span>
            </div>

            <div class="current-run">
              <span class="time"><%= Time::Span.from(current_run.start_time || 0, Time::Span::TicksPerSecond) %></span>
              <span class="progress">Progress: <%= current_run.progress %> of <%= current_run.game.progress_target %></span>
            </div>
          </header>


          <footer>
            <div class="games-table">
              <% runs = team_runs.group_by{ |r| r.game.series } %>
              <% series_order = ["mario", "rare", "spyro", "crash"] %>
              <% series_order.each do |series_name| %>
                <% ordered_runs_for_series = runs[series_name].sort_by{ |r| r.game.sequence_number.not_nil! } %>
                <div class="series <%= series_name %>">
                  <% ordered_runs_for_series.each do |run| %>
                    <div class="game <%= run.game.name.not_nil!.downcase.gsub(' ', "") %>">
                      <span class="game-name"><%= run.game.name %></span>
                      <span class="game-time"><%= Time::Span.from(run.estimate.not_nil!, Time::Span::TicksPerSecond) %></span>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </footer>
        </div>
      <% end %>
    </div>
  </body>

  <script src="moment.min.js"></script>
  <script src="nanoajax.min.js"></script>
  <script src="coming_up.js"></script>
  <script src="on_screen.js"></script>
  <script src="layout.js"></script>
</html>
